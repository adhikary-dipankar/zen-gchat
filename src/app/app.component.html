<div class="min-h-screen bg-gradient-to-br from-blue-100 to-indigo-100 flex flex-col p-4">
  <!-- Header -->
  <header class="fixed top-0 left-0 w-full bg-gradient-to-r from-blue-200 to-indigo-200 p-2 z-10 flex justify-between items-center">
    <h1 class="text-2xl font-extrabold text-zen-blue">ZenZone</h1>
    <div *ngIf="isAuthenticated" class="flex items-center space-x-4">
      <button (click)="toggleProfileModal()" class="flex items-center text-zen-blue hover:text-zen-blue-dark">
        <svg class="w-6 h-6 mr-2" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
        </svg>
        <span>{{ profileModel.username || 'Profile' }}</span>
      </button>
      <button (click)="logout()" class="btn btn-outline-danger text-sm">Logout</button>
    </div>
  </header>

  <!-- Profile Modal -->
  <div *ngIf="showProfileModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-20" @modalFade>
    <div class="bg-white rounded-lg p-6 w-full max-w-md">
      <h2 class="text-lg font-semibold text-zen-blue mb-4">Edit Profile</h2>
      <div *ngIf="profileError" class="alert alert-danger alert-dismissible mb-4" @errorFade>
        <span>{{ profileError }}</span>
        <button type="button" class="btn-close" (click)="clearErrors()"></button>
      </div>
      <div class="mb-4">
        <label for="profileUsername" class="form-label">Username</label>
        <input type="text" class="form-control" id="profileUsername" [(ngModel)]="profileModel.username" name="username" required>
      </div>
      <div class="mb-4">
        <label for="profileBio" class="form-label">Bio</label>
        <textarea class="form-control" id="profileBio" [(ngModel)]="profileModel.bio" name="bio"></textarea>
      </div>
      <div class="flex space-x-2">
        <button type="button" (click)="updateProfile()" class="btn btn-primary w-full">Update Profile</button>
        <button type="button" (click)="toggleProfileModal()" class="btn btn-outline-secondary w-full">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div *ngIf="notificationMessage" class="fixed top-4 right-4 bg-green-500 text-white p-4 rounded-lg shadow-lg z-20" @notificationFade>
    <span>{{ notificationMessage }}</span>
    <button type="button" class="btn-close text-white ml-4" (click)="clearNotification()"></button>
  </div>

<!-- Authentication Section -->
<div
  *ngIf="!isAuthenticated && !showForgotPassword && !showResetPassword"
  class="min-h-screen flex items-center justify-center"
  @formFade
>
  <div class="wrapper">
    <div class="card-switch">
      <label class="switch">
        <input
          type="checkbox"
          class="toggle"
          [(ngModel)]="isLogin"
          (change)="clearErrors()"
          [checked]="!isLogin"
        />
        <span class="slider"></span>
        <span class="card-side"></span>

        <div class="flip-card__inner">
          <!-- LOGIN SIDE -->
          <div class="flip-card__front">
            <div class="title">Log in</div>

            <div
              *ngIf="loginError"
              class="alert alert-danger alert-dismissible mb-4"
              @errorFade
            >
              <span>{{ loginError }}</span>
              <button type="button" class="btn-close" (click)="clearErrors()"></button>
            </div>

            <div class="flip-card__form">
              <input
                class="flip-card__input"
                name="email"
                placeholder="Email"
                type="email"
                [(ngModel)]="loginModel.email"
              />
              <input
                class="flip-card__input"
                name="password"
                placeholder="Password"
                type="password"
                [(ngModel)]="loginModel.password"
              />
              <button class="flip-card__btn" type="button" (click)="login()">
                Let's go!
              </button>
            </div>

            <div id="googleSignInButton" class="w-full mt-2"></div>
            <a
              class="text-sm text-zen-blue hover:underline cursor-pointer"
              (click)="showForgotPassword = true; clearErrors()"
              >Forgot Password?</a
            >
          </div>

          <!-- SIGNUP SIDE -->
          <div class="flip-card__back">
            <div class="title">Sign up</div>

            <div
              *ngIf="signupError"
              class="alert alert-danger alert-dismissible mb-4"
              @errorFade
            >
              <span>{{ signupError }}</span>
              <button type="button" class="btn-close" (click)="clearErrors()"></button>
            </div>

            <div class="flip-card__form">
              <input
                class="flip-card__input"
                placeholder="Name"
                type="text"
                [(ngModel)]="signupModel.username"
                name="username"
              />
              <input
                class="flip-card__input"
                placeholder="Email"
                type="email"
                [(ngModel)]="signupModel.email"
                name="email"
              />
              <input
                class="flip-card__input"
                placeholder="Password"
                type="password"
                [(ngModel)]="signupModel.password"
                name="password"
              />
              <textarea
                class="flip-card__input"
                placeholder="Bio"
                [(ngModel)]="signupModel.bio"
                name="bio"
                style="height: 60px"
              ></textarea>
              <button class="flip-card__btn" type="button" (click)="signup()">
                Confirm!
              </button>
            </div>

            <div id="googleSignInButton" class="w-full mt-2"></div>
          </div>
        </div>
      </label>
    </div>
  </div>
</div>



  

  <!-- Forgot Password Form -->
  <div *ngIf="showForgotPassword" class="mt-20 w-full max-w-md bg-white shadow-lg p-6 rounded-lg" @formFade>
    <h2 class="text-lg font-semibold text-zen-blue mb-4">Forgot Password</h2>
    <div *ngIf="forgotPasswordMessage" class="alert alert-success alert-dismissible mb-4" @errorFade>
      <span>{{ forgotPasswordMessage }}</span>
      <button type="button" class="btn-close" (click)="clearErrors()"></button>
    </div>
    <div *ngIf="forgotPasswordError" class="alert alert-danger alert-dismissible mb-4" @errorFade>
      <span>{{ forgotPasswordError }}</span>
      <button type="button" class="btn-close" (click)="clearErrors()"></button>
    </div>
    <div class="mb-4">
      <label for="forgotEmail" class="form-label">Email</label>
      <input type="email" class="form-control" id="forgotEmail" [(ngModel)]="forgotPasswordModel.email" name="email" required>
    </div>
    <button type="button" (click)="requestPasswordReset()" class="btn btn-primary w-full mb-2">Send Reset Link</button>
    <button type="button" (click)="showForgotPassword = false; clearErrors()" class="btn btn-outline-secondary w-full">Back to Login</button>
  </div>

  <!-- Reset Password Form -->
  <div *ngIf="showResetPassword" class="mt-20 w-full max-w-md bg-white shadow-lg p-6 rounded-lg" @formFade>
    <h2 class="text-lg font-semibold text-zen-blue mb-4">Reset Password</h2>
    <div *ngIf="resetPasswordError" class="alert alert-danger alert-dismissible mb-4" @errorFade>
      <span>{{ resetPasswordError }}</span>
      <button type="button" class="btn-close" (click)="clearErrors()"></button>
    </div>
    <div class="mb-4">
      <label for="resetEmail" class="form-label">Email</label>
      <input type="email" class="form-control" id="resetEmail" [(ngModel)]="resetPasswordModel.email" name="email" required>
    </div>
    <div class="mb-4">
      <label for="resetToken" class="form-label">Reset Token</label>
      <input type="text" class="form-control" id="resetToken" [(ngModel)]="resetPasswordModel.token" name="token" required>
    </div>
    <div class="mb-4">
      <label for="resetNewPassword" class="form-label">New Password</label>
      <input type="password" class="form-control" id="resetNewPassword" [(ngModel)]="resetPasswordModel.newPassword" name="newPassword" required>
    </div>
    <button type="button" (click)="resetPassword()" class="btn btn-primary w-full mb-2">Reset Password</button>
    <button type="button" (click)="showResetPassword = false; showForgotPassword = false; isLogin = true; clearErrors()" class="btn btn-outline-secondary w-full">Back to Login</button>
  </div>

<!-- Chat Interface -->
<div *ngIf="isAuthenticated" class="mt-20 w-full max-w-7xl flex flex-col md:flex-row gap-4">
  <!-- Chat List -->
  <div class="w-full md:w-1/4 bg-white shadow-lg rounded-xl p-4 overflow-y-auto" style="max-height: 600px;">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-semibold text-zen-blue">Chats</h2>
      <button class="btn btn-primary text-sm" (click)="toggleNewChatDropdown()">New Chat</button>
    </div>
    <div *ngIf="showNewChatDropdown" class="relative mb-4" @dropdownFade>
      <select class="form-control w-full" [(ngModel)]="selectedNewChatUserId" (change)="startNewChat()">
        <option value="" disabled selected>Select a user</option>
        <option *ngFor="let user of users" [value]="user.id">{{ user.username }}</option>
      </select>
    </div>
    <div
      *ngFor="let chat of chats; let i = index"
      class="card mb-3 cursor-pointer relative transition duration-300 hover:scale-105 hover:shadow-lg p-3 rounded-xl bg-white"
      (click)="selectChat(chat.id)"
      @cardFade>
      
      <div class="flex items-center gap-3">
        <!-- SVG Icon with dynamic fill color -->
        <svg class="w-10 h-10" [ngStyle]="{ color: chatColors[i % chatColors.length] }" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
        </svg>

        <!-- Username with dynamic text color -->
        <div class="flex-1 min-w-0">
          <h5
            class="font-semibold text-sm leading-tight truncate"
            [ngStyle]="{ color: chatColors[i % chatColors.length] }"
          >
            {{ chat.username }}
          </h5>
          <p class="text-xs leading-snug truncate text-gray-600">
            {{ chat.lastMessage || 'No messages yet' }}
          </p>
        </div>

        <!-- Unread notification dot -->
        <span *ngIf="chat.unreadMessages > 0" class="absolute top-2 right-2 w-3 h-3 bg-red-500 rounded-full"></span>
      </div>
    </div>


  </div>

  <!-- Chat Messages -->
  <div class="w-full md:w-3/4 bg-white shadow-lg rounded-xl p-4 flex flex-col" style="max-height: 600px;">
    <div *ngIf="selectedChatId; else noChatSelected" class="flex-1 overflow-y-auto mb-4">
      <div *ngFor="let message of messages" class="mb-2" [ngClass]="message.senderId === userId ? 'text-right' : 'text-left'" @messageFade>
        <div class="inline-block p-3 rounded-2xl max-w-sm break-words" [ngClass]="message.senderId === userId ? 'bg-zen-blue text-white rounded-br-none' : 'bg-green-200 text-gray-800 rounded-bl-none'">
          <p class="text-[16px] font-semibold leading-none mb-1">{{ message.senderUsername }}</p>
          <p class="text-[14px] leading-snug">{{ message.content }}</p>
          <p class="text-[12px] opacity-70 mt-1 text-right">{{ message.timestamp | date:'shortTime' }}</p>
        </div>
      </div>
    </div>
    <ng-template #noChatSelected>
      <p class="text-center text-gray-500 flex-1 flex items-center justify-center">Select a chat to start messaging.</p>
    </ng-template>
    <div class="input-group">
      <input type="text" class="form-control" [(ngModel)]="newMessage" name="message" placeholder="Type a message..." required>
      <button type="button" (click)="sendMessage()" class="btn btn-primary">Send</button>
    </div>
  </div>
</div>

</div>